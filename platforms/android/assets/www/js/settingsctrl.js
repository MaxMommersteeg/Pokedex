angular.module("starter").controller("SettingsCtrl",["$scope","$http","$ionicPopup","userPreferenceKey","positionPreferenceKey","mapPreferenceKey","pokemonListPreferenceKey","apiWebsite",function(e,t,o,i,n,a,r,s){function l(e,t){e.$$phase||e.$root.$$phase?t():e.$apply(t)}e.user={},e.userposition={},e.map={},e.pokemonlist={},e.watchId={},e.$on("$ionicView.enter",function(){e.initialize(),e.startLocationWatch()}),e.$on("$ionicView.beforeLeave",function(){navigator.geolocation.clearWatch(e.watchId)}),e.startLocationWatch=function(){function t(t){l(e,function(){e.userposition={latitude:t.coords.latitude,longitude:t.coords.longitude}}),window.localStorage.setItem(n,JSON.stringify(e.userposition))}function o(){}e.watchId=navigator.geolocation.watchPosition(t,o,{timeout:8e3})},e.initialize=function(){var t=JSON.parse(window.localStorage.getItem(i));null!=t&&(e.user=t);var o=JSON.parse(window.localStorage.getItem(n));null!=o&&(e.userposition=o);var s=JSON.parse(window.localStorage.getItem(a));null!=s&&(e.map=s);var l=JSON.parse(window.localStorage.getItem(r));null!=l&&(e.pokemonlist=l)},e.updateSettings=function(){(e.user.firstname||e.user.lastname)&&window.localStorage.setItem(i,JSON.stringify(e.user)),(e.map.maximumradius||e.map.catchradius)&&window.localStorage.setItem(a,JSON.stringify(e.map)),e.pokemonlist.size&&window.localStorage.setItem(r,JSON.stringify(e.pokemonlist)),o.alert({title:"Settings",template:"Settings saved"})},e.showOnMap=function(){if(null!=e.userposition)try{launchnavigator.navigate([e.userposition.latitude,e.userposition.longitude])}catch(t){o.alert({title:"Settings",template:"Failed to launch Google Maps or an alternative"})}},e.showPokedexApiWebsite=function(){try{cordova.InAppBrowser.open(s,"_system","location=yes")}catch(e){o.alert({title:"Open external app",template:"Failed to open browser"})}}}]);